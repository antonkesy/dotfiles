---
- name: Setup Arch Linux workstation
  hosts: local
  become: false

  vars_files:
    - group_vars/packages/base.yml
    - group_vars/packages/dev-tools.yml
    - group_vars/packages/filesystem.yml
    - group_vars/packages/git.yml
    - group_vars/packages/terminal.yml
    - group_vars/packages/python.yml
    - group_vars/packages/node.yml
    - group_vars/packages/golang.yml
    - group_vars/packages/rust.yml
    - group_vars/packages/ocaml.yml
    - group_vars/packages/flatpak.yml
    - group_vars/packages/neovim.yml
    - group_vars/packages/lvim.yml
    - group_vars/packages/desktop-gnome.yml
    - group_vars/packages/desktop-network.yml
    - group_vars/packages/desktop-media.yml
    - group_vars/packages/hyprland.yml

  vars:
    dotfiles_dir: "{{ playbook_dir | dirname }}"
    user_name: "{{ ansible_facts['user_id'] }}"
    user_home: "{{ ansible_facts['env']['HOME'] }}"

  pre_tasks:
    - name: Update pacman cache
      become: true
      pacman:
        update_cache: true
      tags: always

  roles:
    # AUR helpers (must be first for yay)
    - { role: aur-helpers, tags: ["base", "aur"] }

    # All packages (pacman, aur, pipx, npm, systemd)
    - { role: packages, tags: ["base", "packages"] }

    # Configuration roles (no package installs)
    - { role: dotfiles, tags: ["base", "dotfiles"] }
    - { role: zsh, tags: ["base", "zsh"] }
    - { role: git, tags: ["base", "git"] }
    - { role: neovim, tags: ["base", "neovim", "editor"] }
    - { role: lvim, tags: ["base", "lvim", "editor"] }
