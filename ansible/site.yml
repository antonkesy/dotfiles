---
- name: Setup Arch Linux workstation
  hosts: local
  become: false

  vars:
    dotfiles_dir: "{{ playbook_dir | dirname }}"
    user_name: "{{ ansible_facts['user_id'] }}"
    user_home: "{{ ansible_facts['env']['HOME'] }}"

  pre_tasks:
    - name: Update pacman cache
      become: true
      pacman:
        update_cache: true
      tags: always

  roles:
    # AUR helpers (must be first for yay)
    - { role: aur-helpers, tags: ["base", "aur"] }

    # All packages (pacman, aur, pipx, npm, systemd)
    - { role: packages, tags: ["base", "packages"] }

    # Configuration roles (no package installs)
    - { role: dotfiles, tags: ["base", "dotfiles"] }
    - { role: zsh, tags: ["base", "zsh"] }
    - { role: git, tags: ["base", "git"] }
    - { role: neovim, tags: ["base", "neovim", "editor"] }
    - { role: lvim, tags: ["base", "lvim", "editor"] }
