- name: Install Android Studio dependencies
  become: true
  community.general.pacman:
    name:
      - jdk-openjdk
    state: present
- name: Install Android Studio from AUR
  ansible.builtin.include_role:
    name: aur_build
  vars:
    package_name: android-studio
- name: Check if Android SDK is already set up
  ansible.builtin.stat:
    path: "{{ ansible_facts['env']['HOME'] }}/Android/Sdk/platform-tools"
  register: android_sdk_check
- name: Create Android SDK directory
  ansible.builtin.file:
    path: "{{ ansible_facts['env']['HOME'] }}/Android/Sdk"
    state: directory
    mode: '0755'
  when: not android_sdk_check.stat.exists
- name: Set up Android SDK via sdkmanager
  ansible.builtin.shell: |
    yes | /opt/android-studio/jbr/bin/java -jar /opt/android-studio/lib/platform-installer.jar \
      install "platform-tools" \
      "platforms;android-34" \
      "build-tools;34.0.0" \
      "emulator" || \
    yes | /opt/android-studio/bin/sdkmanager \
      "platform-tools" \
      "platforms;android-34" \
      "build-tools;34.0.0" \
      "emulator"
  args:
    executable: /bin/bash
  environment:
    ANDROID_HOME: "{{ ansible_facts['env']['HOME'] }}/Android/Sdk"
    JAVA_HOME: /usr/lib/jvm/default
  when: not android_sdk_check.stat.exists
  changed_when: true
  failed_when: false
