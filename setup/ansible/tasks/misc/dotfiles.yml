- name: Ensure stow is installed
  become: true
  community.general.pacman:
    name: stow
    state: present
- name: Define dotfiles root
  ansible.builtin.set_fact:
    dotfiles_root: "{{ playbook_dir | dirname | dirname }}"
- name: Create directories that need to exist before stow runs
  ansible.builtin.file:
    path: "{{ ansible_facts.env.HOME }}/{{ item }}"
    state: directory
    mode: "0755"
  loop:
    - .config/nvim/spell
    - .tmux/plugins
- name: Create untracked zsh config
  ansible.builtin.file:
    path: "{{ dotfiles_root }}/home/.config/zsh/untracked.zsh"
    state: touch
    mode: "0644"
    modification_time: preserve
    access_time: preserve
- name: Unstow all dotfiles
  ansible.builtin.command: stow -vvv -D --target ~ home
  args:
    chdir: "{{ dotfiles_root }}"
  changed_when: false
- name: Restow dotfiles
  ansible.builtin.command: stow -vvv --target ~ home
  args:
    chdir: "{{ dotfiles_root }}"
  changed_when: false
